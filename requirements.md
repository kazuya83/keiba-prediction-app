# 競馬予測アプリケーション 要件定義書

## 1. プロジェクト概要

### 1.1 プロジェクト名
競馬予測アプリケーション（Keiba Prediction App）

### 1.2 目的
過去の競馬試合結果や天候情報をもとに、機械学習を用いて未来の競馬の3着以内を予測するWebアプリケーション

### 1.3 対象ユーザー
- 競馬ファン
- 競馬予測に関心のある一般ユーザー
- 複数ユーザーが利用可能

## 2. 機能要件

### 2.1 ユーザー認証・認可
- **ユーザー登録・ログイン機能**
  - メールアドレスとパスワードでの認証
  - ソーシャルログイン（Google、Twitterなど）対応
  - パスワードの強度チェック
- **ユーザー管理**
  - プロフィール管理
  - アカウント設定

### 2.2 データ管理
- **データ取得**
  - Netkeiba（無料情報）からスクレイピング
  - JRA公式サイトからスクレイピング
  - 地方競馬の公式サイトからスクレイピング
  - または無料で公開されているAPIを使用
- **データ更新**
  - 毎日決まった時刻に自動更新
  - データ更新後に自動で機械学習モデルを再学習
- **データ保存期間**
  - 過去の予測履歴：3年間保存
  - レースデータ：できるだけ多く保存

### 2.3 予測機能
- **予測対象**
  - 3着以内の予測
  - 中央競馬（JRA）および地方競馬
- **予測手法**
  - 機械学習を使用
- **予測実行**
  - ユーザーがボタンを押したときに予測を実行
  - 予測完了時間：1分以内
- **予測結果の表示**
  - 確率を数値で表示
  - 表形式とグラフ形式の両方で表示
  - 予測の根拠・説明を表示
- **予測に使用するデータ**
  - レース結果（着順、タイム、上がり3Fなど）
  - 天候・馬場状態
  - 馬の過去成績
  - 騎手の成績
  - 血統情報

### 2.4 レース選択
- **レース選択方法**
  - レース一覧から選択
  - 中央競馬および地方競馬のレースを対象

### 2.5 予測履歴管理
- **予測履歴の保存**
  - ユーザーごとに予測履歴を保存
  - 保存期間：3年間
- **予測精度の表示**
  - 的中率（何回中何回当たったか）
  - 回収率（投資額に対する回収額）
  - 平均確率の信頼度
- **予測結果の比較機能**
  - 過去の予測と現在の予測の比較

### 2.6 通知機能
- **通知方法**
  - アプリ内通知
  - ブラウザ通知（プッシュ通知）- サーバを別で立てずにできる場合のみ
- **通知タイミング**
  - 予測結果が出たとき
  - レース結果が確定したとき（予測の的中状況）
- **通知設定**
  - ユーザーが指定したレースのみ通知

### 2.7 共有機能
- **予測結果の共有**
  - URLをコピーして共有

### 2.8 管理者機能
- **管理者による管理機能**
  - ユーザー管理
  - データ管理
  - 予測モデルの管理
  - エラーログの確認

### 2.9 エラーハンドリング
- **エラー処理**
  - エラーログを記録して管理者に通知
  - ユーザーに再試行を促す

## 3. 非機能要件

### 3.1 パフォーマンス
- 予測の完了時間：1分以内
- APIの応答時間：適切なレスポンス時間を維持

### 3.2 セキュリティ
- パスワードの強度チェック
- レート制限（APIの呼び出し制限）
- 標準的なセキュリティ対策を実施

### 3.3 可用性
- クラウド環境（AWS、Azure、GCPなど）にデプロイ

### 3.4 開発環境
- Docker上で動作可能にする

### 3.5 UI/UX
- モダンでおしゃれなデザイン
- 使いやすいインターフェース

## 4. 技術スタック

### 4.1 フロントエンド
- **フレームワーク**: React
- **言語**: JavaScript/TypeScript

### 4.2 バックエンド
- **言語**: Python
- **API**: REST API
- **フレームワーク**: Flask または FastAPI（開発しやすいものを選択）

### 4.3 データベース
- 開発しやすいデータベース（PostgreSQL または SQLite を推奨）

### 4.4 機械学習
- **ライブラリ**: scikit-learn、pandas、numpy など
- **深層学習**: TensorFlow または PyTorch（必要に応じて）

### 4.5 インフラストラクチャ
- **コンテナ**: Docker
- **デプロイ**: クラウド環境（AWS、Azure、GCPなど）

### 4.6 その他
- **データスクレイピング**: BeautifulSoup、Scrapy、Selenium など
- **通知**: Web Push API（ブラウザ通知）

## 5. システム構成

### 5.1 アーキテクチャ
```
[フロントエンド (React)]
    ↓
[REST API (Python)]
    ↓
[データベース]
    ↓
[機械学習モデル]
    ↓
[データスクレイピング・更新処理]
```

### 5.2 主要コンポーネント
1. **認証サービス**: ユーザー認証・認可
2. **データ取得サービス**: スクレイピング・API連携
3. **予測サービス**: 機械学習による予測処理
4. **通知サービス**: アプリ内通知・ブラウザ通知
5. **管理サービス**: 管理者機能

## 6. データモデル（概要）

### 6.1 主要エンティティ
- **User**: ユーザー情報
- **Race**: レース情報
- **Horse**: 馬情報
- **Jockey**: 騎手情報
- **Trainer**: 調教師情報
- **Prediction**: 予測結果
- **PredictionHistory**: 予測履歴
- **RaceResult**: レース結果
- **Weather**: 天候情報

## 7. API設計（概要）

### 7.1 認証API
- `POST /api/auth/register` - ユーザー登録
- `POST /api/auth/login` - ログイン
- `POST /api/auth/logout` - ログアウト
- `POST /api/auth/social-login` - ソーシャルログイン

### 7.2 レースAPI
- `GET /api/races` - レース一覧取得
- `GET /api/races/{race_id}` - レース詳細取得

### 7.3 予測API
- `POST /api/predictions` - 予測実行
- `GET /api/predictions` - 予測履歴取得
- `GET /api/predictions/{prediction_id}` - 予測詳細取得
- `GET /api/predictions/{prediction_id}/compare` - 予測比較

### 7.4 通知API
- `GET /api/notifications` - 通知一覧取得
- `PUT /api/notifications/{notification_id}/read` - 通知を既読にする
- `POST /api/notifications/settings` - 通知設定

### 7.5 管理者API
- `GET /api/admin/users` - ユーザー一覧
- `GET /api/admin/errors` - エラーログ取得
- `POST /api/admin/model/train` - モデル学習実行

## 8. UI/UX要件

### 8.1 ページ構成
1. **ログイン・登録ページ**
2. **ダッシュボード**
3. **レース一覧ページ**
4. **予測ページ**
5. **予測履歴ページ**
6. **予測精度ページ**
7. **通知ページ**
8. **設定ページ**
9. **管理者ページ**

### 8.2 デザイン要件
- モダンでおしゃれなデザイン
- レスポンシブデザイン（モバイル対応）
- 直感的な操作が可能なUI

## 9. セキュリティ要件

### 9.1 認証・認可
- パスワードの強度チェック
- トークンベースの認証（JWT推奨）
- ソーシャルログイン対応

### 9.2 APIセキュリティ
- レート制限の実装
- HTTPS通信
- CORS設定

### 9.3 データ保護
- パスワードのハッシュ化
- 個人情報の保護

## 10. デプロイ要件

### 10.1 デプロイ環境
- クラウド環境（AWS、Azure、GCPなど）
- Dockerコンテナでのデプロイ

### 10.2 環境変数
- データベース接続情報
- APIキー
- 認証トークン
- その他機密情報

## 11. 開発要件

### 11.1 開発環境
- Docker上で動作可能
- ローカル開発環境の構築が容易

### 11.2 コード管理
- Gitによるバージョン管理
- 適切なブランチ戦略

## 12. テスト要件

### 12.1 テスト種別
- 単体テスト
- 統合テスト
- E2Eテスト（必要に応じて）

## 13. ドキュメント要件

### 13.1 必要なドキュメント
- API仕様書
- データベース設計書
- システム構成図
- ユーザーガイド

## 14. 今後の拡張性

### 14.1 将来の拡張機能
- より詳細な予測分析
- 他の競技への対応
- モバイルアプリの開発
- リアルタイム予測機能

---

作成日: 2025年
承認者: _______________




