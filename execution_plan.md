# 競馬予測アプリケーション 実行計画書

## 1. プロジェクト構造

### 1.1 ディレクトリ構成
```
keiba/
├── frontend/                 # フロントエンド（React）
│   ├── public/
│   ├── src/
│   │   ├── components/      # コンポーネント
│   │   ├── pages/           # ページコンポーネント
│   │   ├── services/        # API通信
│   │   ├── utils/           # ユーティリティ
│   │   ├── hooks/           # カスタムフック
│   │   ├── context/         # Context API
│   │   ├── types/           # TypeScript型定義
│   │   └── App.tsx
│   ├── package.json
│   └── Dockerfile
│
├── backend/                  # バックエンド（FastAPI）
│   ├── app/
│   │   ├── api/             # APIエンドポイント
│   │   │   ├── auth.py      # 認証API
│   │   │   ├── races.py     # レースAPI
│   │   │   ├── predictions.py # 予測API
│   │   │   ├── notifications.py # 通知API
│   │   │   └── admin.py     # 管理者API
│   │   ├── core/            # コア機能
│   │   │   ├── config.py    # 設定
│   │   │   ├── security.py  # セキュリティ
│   │   │   └── database.py  # データベース
│   │   ├── models/          # データモデル
│   │   ├── schemas/         # Pydanticスキーマ
│   │   ├── services/        # ビジネスロジック
│   │   │   ├── auth_service.py
│   │   │   ├── race_service.py
│   │   │   ├── prediction_service.py
│   │   │   ├── ml_service.py # 機械学習サービス
│   │   │   └── scraping_service.py # スクレイピングサービス
│   │   ├── tasks/           # バックグラウンドタスク
│   │   │   ├── data_update.py # データ更新タスク
│   │   │   └── model_training.py # モデル学習タスク
│   │   └── main.py          # アプリケーションエントリーポイント
│   ├── requirements.txt
│   ├── Dockerfile
│   └── alembic/             # データベースマイグレーション
│
├── ml/                      # 機械学習関連
│   ├── models/              # 学習済みモデル
│   ├── notebooks/           # Jupyterノートブック
│   ├── training/            # 学習スクリプト
│   └── preprocessing/       # データ前処理
│
├── docker-compose.yml       # Docker Compose設定
├── .env.example             # 環境変数サンプル
└── README.md                # プロジェクト説明
```

## 2. 開発フェーズ

### フェーズ1: プロジェクト基盤構築（1-2週間）

#### 2.1 バックエンド基盤
- [ ] プロジェクト初期化（FastAPI、PostgreSQL）
- [ ] Docker環境構築（docker-compose.yml）
- [ ] データベース接続設定
- [ ] 環境変数管理（.env）
- [ ] ロギング設定
- [ ] エラーハンドリング基盤
- [ ] CORS設定
- [ ] 基本的なAPI構造の作成

#### 2.2 フロントエンド基盤
- [ ] React + TypeScript プロジェクト初期化
- [ ] ルーティング設定（React Router）
- [ ] 状態管理ライブラリ選定・設定（Context API / Redux）
- [ ] API通信ライブラリ設定（axios）
- [ ] UIライブラリ導入（Material-UI / Tailwind CSS）
- [ ] レイアウトコンポーネント作成
- [ ] 環境変数設定

#### 2.3 データベース設計
- [ ] データモデル設計
  - User（ユーザー情報）
  - Race（レース情報）
  - Horse（馬情報）
  - Jockey（騎手情報）
  - Trainer（調教師情報）
  - Prediction（予測結果）
  - PredictionHistory（予測履歴）
  - RaceResult（レース結果）
  - Weather（天候情報）
  - Notification（通知情報）
- [ ] データベースマイグレーション設定（Alembic）
- [ ] 初期データ投入スクリプト

### フェーズ2: 認証・認可機能（1週間）

#### 2.1 バックエンド
- [ ] ユーザー登録API実装
  - パスワード強度チェック
  - パスワードハッシュ化（bcrypt）
  - メールアドレス重複チェック
- [ ] ログインAPI実装
  - JWTトークン発行
  - リフレッシュトークン実装
- [ ] ログアウトAPI実装
- [ ] ソーシャルログインAPI実装（Google、Twitter）
  - OAuth2.0設定
- [ ] 認証ミドルウェア実装
- [ ] パスワードリセット機能（必要に応じて）

#### 2.2 フロントエンド
- [ ] ログインページ実装
- [ ] ユーザー登録ページ実装
- [ ] 認証コンテキスト作成
- [ ] 保護されたルート実装
- [ ] ソーシャルログインボタン実装
- [ ] ログアウト機能実装
- [ ] トークン管理（localStorage / sessionStorage）

### フェーズ3: データ管理機能（2-3週間）

#### 3.1 バックエンド
- [ ] スクレイピングサービス実装
  - Netkeibaスクレイピング
  - JRA公式サイトスクレイピング
  - 地方競馬サイトスクレイピング
  - BeautifulSoup / Scrapy / Selenium使用
- [ ] データ取得API実装
  - レース一覧取得API
  - レース詳細取得API
  - 馬情報取得API
  - 騎手情報取得API
- [ ] データ更新タスク実装
  - 定期実行スケジューラー（APScheduler / Celery）
  - 毎日決まった時刻に自動更新
- [ ] データベースへの保存処理
- [ ] エラーハンドリング・ログ記録

#### 3.2 フロントエンド
- [ ] レース一覧ページ実装
  - レース検索・フィルタリング
  - ページネーション
- [ ] レース詳細ページ実装
  - レース情報表示
  - 出走馬一覧表示
  - 過去成績表示

### フェーズ4: 予測機能（3-4週間）

#### 4.1 機械学習モデル開発
- [ ] データ前処理パイプライン作成
  - 特徴量エンジニアリング
  - データクリーニング
- [ ] 機械学習モデル選定・実装
  - scikit-learn（Random Forest、XGBoost等）
  - 必要に応じてTensorFlow / PyTorch
- [ ] モデル学習スクリプト作成
- [ ] モデル評価・チューニング
- [ ] モデル保存・読み込み機能

#### 4.2 バックエンド
- [ ] 予測サービス実装
  - 予測実行API
  - 特徴量抽出
  - モデル推論
  - 予測結果の保存
- [ ] 予測履歴API実装
  - 予測履歴取得API
  - 予測詳細取得API
  - 予測比較API
- [ ] モデル再学習タスク実装
  - データ更新後の自動再学習
- [ ] 予測精度計算機能
  - 的中率計算
  - 回収率計算

#### 4.3 フロントエンド
- [ ] 予測ページ実装
  - レース選択UI
  - 予測実行ボタン
  - ローディング表示
- [ ] 予測結果表示
  - 確率表示（表形式）
  - 確率表示（グラフ形式）
  - 予測の根拠・説明表示
  - Chart.js / Recharts使用
- [ ] 予測履歴ページ実装
  - 予測履歴一覧
  - 予測詳細表示
  - 予測比較機能
- [ ] 予測精度ページ実装
  - 的中率表示
  - 回収率表示
  - 平均確率の信頼度表示

### フェーズ5: UI/UX改善（1-2週間）

#### 5.1 フロントエンド
- [ ] ダッシュボードページ実装
  - 統計情報表示
  - 最近の予測表示
  - クイックアクセス
- [ ] 設定ページ実装
  - プロフィール編集
  - アカウント設定
  - 通知設定
- [ ] レスポンシブデザイン対応
  - モバイル対応
  - タブレット対応
- [ ] デザイン改善
  - モダンなUIデザイン
  - アニメーション効果
  - ダークモード対応（オプション）

### フェーズ6: 通知機能（1週間）

#### 6.1 バックエンド
- [ ] 通知サービス実装
  - アプリ内通知保存
  - 通知一覧取得API
  - 通知既読API
  - 通知設定API
- [ ] プッシュ通知実装（オプション）
  - Web Push API統合
  - 通知送信処理

#### 6.2 フロントエンド
- [ ] 通知ページ実装
  - 通知一覧表示
  - 通知既読機能
- [ ] 通知バッジ実装
  - 未読通知数表示
- [ ] ブラウザ通知実装（オプション）
  - Web Push API統合
  - 通知許可要求

### フェーズ7: 管理者機能（1週間）

#### 7.1 バックエンド
- [ ] 管理者認証実装
  - 管理者ロール管理
  - 管理者専用API
- [ ] ユーザー管理API実装
  - ユーザー一覧取得
  - ユーザー情報更新
  - ユーザー削除
- [ ] データ管理API実装
  - データ更新手動実行
  - データ確認
- [ ] モデル管理API実装
  - モデル学習手動実行
  - モデル情報取得
- [ ] エラーログAPI実装
  - エラーログ取得
  - エラーログ検索

#### 7.2 フロントエンド
- [ ] 管理者ページ実装
  - ユーザー管理画面
  - データ管理画面
  - モデル管理画面
  - エラーログ画面

### フェーズ8: 共有機能・その他（1週間）

#### 8.1 バックエンド
- [ ] 予測結果共有API実装
  - 共有用URL生成
  - 共有リンクアクセス

#### 8.2 フロントエンド
- [ ] 共有機能実装
  - URLコピーボタン
  - 共有リンク表示

### フェーズ9: テスト・最適化（1-2週間）

#### 9.1 バックエンド
- [ ] 単体テスト実装
- [ ] 統合テスト実装
- [ ] APIテスト実装
- [ ] パフォーマンス最適化
  - データベースクエリ最適化
  - キャッシュ実装（Redis）
- [ ] セキュリティ対策
  - レート制限実装
  - SQLインジェクション対策
  - XSS対策

#### 9.2 フロントエンド
- [ ] 単体テスト実装（Jest）
- [ ] コンポーネントテスト実装（React Testing Library）
- [ ] E2Eテスト実装（Cypress / Playwright）
- [ ] パフォーマンス最適化
  - コード分割
  - 画像最適化
  - レンダリング最適化

### フェーズ10: デプロイ・ドキュメント（1週間）

#### 10.1 デプロイ
- [ ] Dockerコンテナビルド最適化
- [ ] クラウド環境選定（AWS / Azure / GCP）
- [ ] CI/CDパイプライン構築
- [ ] 本番環境デプロイ
- [ ] 環境変数設定
- [ ] ドメイン設定
- [ ] SSL証明書設定

#### 10.2 ドキュメント
- [ ] API仕様書作成（OpenAPI / Swagger）
- [ ] データベース設計書作成
- [ ] システム構成図作成
- [ ] ユーザーガイド作成
- [ ] README.md更新
- [ ] 開発ガイド作成

## 3. 技術スタック詳細

### 3.1 バックエンド
- **フレームワーク**: FastAPI
- **言語**: Python 3.11+
- **データベース**: PostgreSQL
- **ORM**: SQLAlchemy
- **マイグレーション**: Alembic
- **認証**: JWT (python-jose)
- **パスワードハッシュ**: bcrypt
- **スクレイピング**: BeautifulSoup4, Scrapy, Selenium
- **機械学習**: scikit-learn, pandas, numpy, XGBoost
- **タスクスケジューラー**: APScheduler / Celery
- **キャッシュ**: Redis（オプション）
- **テスト**: pytest

### 3.2 フロントエンド
- **フレームワーク**: React 18+
- **言語**: TypeScript
- **ルーティング**: React Router v6
- **状態管理**: Context API / Zustand
- **API通信**: axios
- **UIライブラリ**: Material-UI / Tailwind CSS + Headless UI
- **グラフ**: Chart.js / Recharts
- **フォーム**: React Hook Form
- **バリデーション**: Zod / Yup
- **テスト**: Jest, React Testing Library
- **E2Eテスト**: Cypress / Playwright

### 3.3 インフラ
- **コンテナ**: Docker, Docker Compose
- **データベース**: PostgreSQL
- **キャッシュ**: Redis（オプション）
- **デプロイ**: AWS / Azure / GCP
- **CI/CD**: GitHub Actions / GitLab CI

## 4. 実装の優先順位

### 最優先（MVP）
1. プロジェクト基盤構築
2. 認証・認可機能
3. データ管理機能（基本的なデータ取得）
4. 予測機能（基本的な予測）
5. UI/UX（基本的なページ）

### 次優先
6. 予測履歴管理
7. 通知機能
8. UI/UX改善

### 低優先
9. 管理者機能
10. 共有機能
11. ソーシャルログイン（後回し可能）

## 5. 注意事項

### 5.1 スクレイピング
- 利用規約の遵守
- サーバー負荷を考慮したリクエスト間隔設定
- エラーハンドリングの徹底
- ロボット排除対策への対応

### 5.2 機械学習
- モデルの精度向上が最重要
- 定期的な再学習が必要
- 予測時間の最適化（1分以内）

### 5.3 セキュリティ
- パスワードの強度チェック
- レート制限の実装
- HTTPS通信の必須化
- SQLインジェクション対策
- XSS対策

### 5.4 パフォーマンス
- データベースクエリの最適化
- キャッシュの活用
- APIの応答時間最適化
- フロントエンドのコード分割

### 5.5 データ保存
- 予測履歴：3年間保存
- レースデータ：できるだけ多く保存
- データバックアップの実施

## 6. 開発スケジュール（概算）

- **フェーズ1**: 1-2週間
- **フェーズ2**: 1週間
- **フェーズ3**: 2-3週間
- **フェーズ4**: 3-4週間
- **フェーズ5**: 1-2週間
- **フェーズ6**: 1週間
- **フェーズ7**: 1週間
- **フェーズ8**: 1週間
- **フェーズ9**: 1-2週間
- **フェーズ10**: 1週間

**合計**: 約13-18週間（3-4.5ヶ月）

## 7. リスク管理

### 7.1 技術的リスク
- スクレイピングサイトの仕様変更
- 機械学習モデルの精度不足
- パフォーマンス問題

### 7.2 対策
- スクレイピングの柔軟な設計
- モデルの継続的な改善
- パフォーマンステストの実施
- モニタリングの実装

## 8. 次のステップ

1. プロジェクト基盤構築から開始
2. 各フェーズごとに動作確認
3. 定期的なコードレビュー
4. 継続的なテスト実施
5. ドキュメントの随時更新

---

作成日: 2025年
更新日: 2025年



