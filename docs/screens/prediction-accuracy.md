# 予測精度ページ 仕様

## 概要
- 期間・条件別に予測の的中率や回収率などを可視化し、モデル性能を評価する画面。
- ユーザー自身の成績とモデル全体の指標を比較できるようにする。

## ペルソナとユースケース
- 一般ユーザー：自身の予測がどの程度的中しているかを把握し、改善ポイントを探る。
- 上級ユーザー：特定条件下でのモデル性能を分析し、予測戦略を調整。
- 管理者：モデル品質を監視し、異常検知や再学習の判断材料とする。

## 前提・依存
- API：`GET /api/predictions/stats`（期間・条件フィルタ対応）、`GET /api/predictions/compare`（ユーザー vs 全体）。
- モデル学習パイプライン（計画15）が評価指標（的中率、回収率、AUC、Brierスコア等）を保存している。
- レース結果更新が完了していることが前提。

## UI構成
- フィルタバー：期間、開催場、レース条件（芝/ダート・距離・クラス）、モデルバージョン。
- KPIカード：的中率、回収率、平均確率信頼度、サンプル数。
- グラフセクション：
  - 折れ線グラフ：期間別的中率推移。
  - ヒートマップ：条件別回収率。
  - 棒グラフ：モデル別指標比較。
- 詳細テーブル：フィルタ条件ごとの指標一覧（平均オッズ、的中数、回収額等）。
- ノートエリア：モデルアップデート履歴や注釈を表示。

## データ要件
- APIレスポンス：`metrics`（`hitRate`、`returnRate`、`averageProbability`, `samples`）、`trend[]`（日付・指標）、`breakdown[]`（条件ごとの指標）、`modelComparisons[]`。
- ユーザー個別指標と全体平均を併記、表示切替ボタンを用意。
- フィルタはクエリパラメータで受け渡し、未指定時は直近30日・全条件。

## 状態と遷移
- 初期：ローディング後に最新期間の指標表示。
- フィルタ変更：スケルトン表示、結果0件は「データなし」とフィードバック。
- モデルバージョン切替：グラフとテーブルを更新し、差分をハイライト。
- エクスポート：CSV/PNGダウンロードはサーバサイド生成とする（オプション）。

## インタラクション
- グラフホバーで詳細値を表示、範囲選択でズームイン可能にする。
- 指標カードクリックで詳細テーブルをフィルタリング（例：的中率カード→的中率上位順）。
- モデル比較グラフで特定モデルを非表示にするトグル。
- ノートエリアからモデルバージョン履歴ページへ遷移。

## バリデーション・エラーハンドリング
- フィルタ期間が3年を超える場合は警告表示。
- データ欠損や計算不能（分母0）の場合は`-`表記と注釈を付与。
- API失敗時は再試行ボタン、複数回失敗でサポート案内。

## 計測・ログ
- `prediction_accuracy_viewed`イベントでフィルタ条件とモデルバージョンを送信。
- グラフ操作（ズーム、モデル切替）やエクスポートを計測。
- 異常に低い指標が発生した場合はバックエンドからアラートを発火する拡張も検討。

## アクセシビリティ
- グラフには代替テキストと表形式のサマリを提供。
- カラーパターンはWCAG準拠のコントラストを確保し、色盲対応パレットを採用。
- フィルタフォームはキーボードで操作できるように適切なタブ順序を設定。

## テスト観点
- 単体：フィルタステート管理、APIレスポンス整形、指標計算。
- 統合：APIモックで条件別指標を検証、モデル比較の表示切替。
- E2E：フィルタ変更→グラフ更新→エクスポートまでの操作、空データ時の表示確認。

## 未決定事項・メモ
- 表示する追加指標（ROI、平均人気順位など）の優先度。
- モデルバージョン履歴の取得方法（別APIか同レスポンスか）。
- グラフライブラリの選定（Victory、Recharts、ECharts等）。

