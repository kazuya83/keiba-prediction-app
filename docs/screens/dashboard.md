# ダッシュボードページ 仕様

## 概要
- ログイン直後に表示されるハブ画面として、主要KPIと最新情報をサマリ表示する。
- 予測履歴、未読通知、推奨レースなど複数機能へのショートカットを提供する。
- 予測モデルの最新バージョンやシステムステータスのステータス提示も考慮する。

## ペルソナとユースケース
- 一般ユーザー：当日の注目レースや自分の予測結果の概要を素早く確認。
- 上級ユーザー：予測精度や回収率を監視し、詳細分析ページへ遷移。
- 管理者：重要アラート（データ更新失敗等）の確認ができるようにする。

## 前提・依存
- API：`GET /api/predictions?limit=5`、`GET /api/predictions/stats/summary`（計画08想定）、`GET /api/notifications?unread_count=true`。
- 推奨レースカードに利用するデータは`GET /api/races`のフィルタ結果。
- ユーザー情報は認証ストアから取得済み。

## UI構成
- ヘッダー：挨拶、ユーザーメニュー、設定・ログアウト導線。
- KPIカード：最新予測的中率、回収率、未読通知数など3〜4枚。
- 予測履歴リスト：最新5件、各カードから詳細へ遷移。
- 推奨レース：当日レースの抜粋、予測ページへのCTAを配置。
- システムステータス：データ更新日時、モデルバージョン、アラート表示領域。

## データ要件
- KPIは期間フィルタ（7日、30日）を切替可能にする。
- 予測履歴カードに含める要素：レース名、開催日時、予測上位3頭、予測確率。
- 推奨レースはDB側でタグ付けされたレースまたは人気順を利用、API拡張が必要な場合は要相談。

## 状態と遷移
- 初期状態：カードはローディングスケルトンを表示。
- データ取得成功：各ウィジェットを順次フェードイン。
- データ取得失敗：リトライボタンとフィードバックメッセージを表示、個別ウィジェット単位でエラー処理。
- 未ログイン：ProtectedRouteによりログインページへリダイレクト。
- 空データ：履歴がない場合はプレースホルダー/ガイドを表示。

## インタラクション
- KPIカードの期間切替でAPI再取得。
- 各履歴カードクリックで予測詳細へ、オーバーフロー時は「もっと見る」で履歴ページへ。
- 推奨レースカードのCTAで対象レースの予測ページに遷移（レースID付きルーティング）。
- 未読通知バッジクリックで通知ページへ遷移し既読処理を呼び出す。

## バリデーション・エラーハンドリング
- APIレスポンスの欠損値はクライアント側で安全にフォールバック（`-`や`N/A`表記）。
- 取得失敗時は5xx/429など種別に応じて文言変更し、リトライ制限を設ける。

## 計測・ログ
- ダッシュボード表示時に`dashboard_viewed`イベントを発火。
- KPIタブ切替、履歴リンククリック、推奨レースCTAクリックをトラッキング。
- 致命的なデータ取得失敗はエラーログ・Sentryへ送信。

## アクセシビリティ
- カードは`role="article"`を付与、キーボード操作でフォーカス移動可能にする。
- 色覚バリアフリー配色とアイコン＋テキスト併用で状態を表現。
- KPIの棒グラフ等はSR向けテキストで数値を読み上げる。

## テスト観点
- 単体：各ウィジェットのローディング/成功/失敗表示、期間切替ロジック。
- 統合：APIモックを利用した複合表示、ProtectedRouteの挙動。
- E2E：ログイン→ダッシュボード表示→履歴/通知遷移のシナリオ。

## 未決定事項・メモ
- 推奨レース抽出ロジック（人気順かモデル推奨か）の確定。
- KPIの追加メトリクス（例：平均オッズ、モデルバージョン比較）。
- システムアラートの扱い（管理者限定表示か全ユーザー表示か）。

