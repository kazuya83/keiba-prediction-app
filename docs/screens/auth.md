# ログイン・登録ページ 仕様

## 概要
- メールアドレス/パスワードとソーシャルログイン（Google・Twitter想定）を提供する認証入口。
- JWTとリフレッシュトークンを取得し、ダッシュボードへ遷移するまでの導線を担保する。
- パスワードリセット、利用規約、プライバシーポリシーへの導線を明示する。

## ペルソナとユースケース
- 一般ユーザー：既存アカウントでログインし、予測機能や履歴へアクセスする。
- 新規ユーザー：メールアドレスとパスワードで登録し、初回ログイン状態へ遷移する。
- 管理者：同一フォームを利用するが、権限付与はバックエンド判定とする。

## 前提・依存
- バックエンドAPI：`POST /api/auth/register`、`POST /api/auth/login`、`POST /api/auth/social-login`、`POST /api/auth/logout`。
- トークン管理はグローバルストア（Zustand/Redux Toolkit）で実装済みとし、記憶ルールはセキュリティ方針に従う。
- ソーシャルログインURLはバックエンドから取得し、ポップアップまたは別タブで認証する。
- ReCAPTCHA等のボット対策を導入する場合はAPI側の準備が必須。

## UI構成
- タブ切替（ログイン/新規登録）。
- フォームフィールド：メール、パスワード、パスワード確認（登録時）、パスワード強度メーター。
- ソーシャルログインボタン（プロバイダごとにブランドカラーを適用）。
- 補助導線：パスワードリセットリンク、利用規約/プライバシーポリシーへのリンク。
- 状態表示：エラーメッセージ領域、成功後のリダイレクト制御。

## データ要件
- メール：RFC 5322準拠の形式チェック、重複登録チェック。
- パスワード：8文字以上、大文字/小文字/数字/記号のうち3種以上を推奨。
- ソーシャルログイン：バックエンドから渡される`authUrl`とCSRF対策用`state`。
- レスポンス：`accessToken`、`refreshToken`、ユーザー基本情報（氏名/ニックネーム/ロール）。

## 状態と遷移
- 初期表示：ログインタブ選択済み、フィールドは空。
- 入力中：フィールドごとにリアルタイムバリデーションと強度表示。
- 送信中：フォーム全体をロックし、スピナー表示。
- 成功：トークン保存後に`/dashboard`へ遷移。
- 失敗：APIエラーメッセージを整形表示（認証失敗/アカウント未確認/レート制限などカテゴリ化）。
- ソーシャルログイン：ポップアップで成功後、アクセストークンを受領しダッシュボードへ遷移。

## バリデーション・エラーハンドリング
- クライアント側：必須入力、形式チェック、パスワード一致確認。
- サーバ側：HTTP 400/401/429/500に応じたメッセージマッピング。
- 多要素認証を拡張する場合は追加入力手順（OTPコード）をモーダルで挿入。
- 連続失敗時はクールダウンやキャプチャ要求を表示。

## 計測・ログ
- ログイン成功率、登録完了率、ソーシャルログイン比率を計測。
- 主要イベント：`auth_login_submitted`、`auth_login_failed`、`auth_signup_completed`。
- 監査ログ：重要操作はバックエンドが`audit_log`に記録する。

## アクセシビリティ
- 全フィールドに`label`と`aria-describedby`を付与し、エラー文言は視覚/音声両対応とする。
- ソーシャルボタンはキーボード操作とスクリーンリーダー用テキストを追加。
- フォームタブは`role="tablist"`で実装し、フォーカスインジケータを明示する。

## テスト観点
- 単体：フォームバリデーション、エラーメッセージ表示、ソーシャルログインURL取得。
- 統合：正常ログイン、認証失敗、ロックアウトシナリオ、アクセストークン更新。
- E2E：メール認証→ログイン→ログアウトの一連フロー、ソーシャルログイン成功/キャンセル。

## 未決定事項・メモ
- ソーシャルログイン対象プロバイダの最終確定。
- パスワードリセット手順（メールリンク/ワンタイムコード）のUI設計は別途定義。
- 利用規約更新時の必須同意フローは設定ページと合わせて検討する。

