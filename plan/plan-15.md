# 実行計画 15: 機械学習学習パイプライン実装

## ゴール
- 特徴量抽出からモデル学習、評価、成果物保存までのパイプラインを自動化する。

## 手順
1. `ml/` ディレクトリを作成し、`pyproject.toml` で `pandas`, `numpy`, `scikit-learn`, `lightgbm`, `xgboost`, `optuna` 等の依存を管理。
2. `ml/data/` に特徴量定義モジュールを作成し、データベースからデータを取得するリポジトリ層を実装（SQLAlchemy or `psycopg`）。
3. 特徴量エンジニアリング（欠損補完、標準化、カテゴリエンコード）を `ml/features/pipelines.py` で定義。
4. `ml/train.py` を実装し、学習データ分割、ハイパーパラメータチューニング、モデル評価指標（的中率/回収率/AUC/Brier）を計算。
5. トレーニング結果を `ml/artifacts/` に保存（モデルファイル、特徴量スキーマ、メタデータJSON）。
6. 実験管理（Optuna Study、MLflowなど）を導入し、実験結果を記録。
7. `pytest` または `great_expectations` で特徴量の品質チェックを実装し、CIで実行。

## 成果物
- 自動実行可能な `python -m ml.train` スクリプト。
- モデル成果物（`model.pkl` など）と評価レポート（Markdown or HTML）。
- 特徴量スキーマ定義と品質チェックレポート。

## 依存・前提
- 計画12でスクレイピング/データ投入が行われ、必要なデータがDBに存在。
- 推論API（計画09）で利用する特徴量仕様が共有されている。

## リスクと対策
- **リスク**: データ品質不足で学習失敗。  
  **対策**: 前処理段階でドロップ/補完ルールを明示し、品質レポートで警告。
- **リスク**: モデル成果物とAPIの整合が取れない。  
  **対策**: モデルメタデータにスキーマ版を含め、API側で検証。*** End Patch

