# 実行計画 20: 本番デプロイと監視基盤構築

## ゴール
- 本番環境へ安全にデプロイし、稼働監視・アラートを整備して安定運用できる状態にする。

## 手順
1. IaC（Terraform/Pulumi）でVPC, Subnet, ECS/EKS/Fargate等のインフラをコード化し、`infra/` ディレクトリに配置。
2. CI/CDパイプライン（GitHub Actionsなど）にステージング→本番デプロイジョブを追加し、手動承認ステップを設ける。
3. Dockerイメージをコンテナレジストリ（ECR/GCR等）へプッシュし、タグ管理（`main-<sha>`）を実施。
4. ステージング環境でSmokeテスト（APIヘルスチェック、E2E短縮版）を自動実行し、成功時のみ本番デプロイ。
5. 監視スタック（CloudWatch/Prometheus + Grafana）を構築し、APIレスポンス時間、エラーレート、ジョブ成功率などのメトリクスダッシュボードを作成。
6. アラートルールを設定し、重大度ごとに通知チャネル（Slack/メール）を割り当て。予測SLA/SLOを指標化。
7. ロールバック手順とデプロイRunbookを `docs/runbook.md` に追記し、演習としてデプロイ→ロールバックを1回実施。

## 成果物
- `infra/` 配下のIaCコードとCI/CDワークフロー。
- 本番デプロイが成功し、監視ダッシュボード・アラートが稼働。
- Runbook更新（ロールバック手順、アラート対応手順）。

## 依存・前提
- コンテナイメージがビルド可能（計画16）で、テストスイート（計画18）がグリーン。
- ドキュメント（計画19）が最新で、Runbookに追記できる。

## リスクと対策
- **リスク**: デプロイ失敗によるサービス停止。  
  **対策**: Blue/Green or Canary戦略を採用し、ロールバックを即時実行可能にする。
- **リスク**: 監視不足で異常検知が遅れる。  
  **対策**: 主要SLOにアラート閾値を設定し、定期的に監視設定をレビュー。

