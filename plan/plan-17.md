# 実行計画 17: データ更新ジョブとスケジューラ実装

## ゴール
- 毎日決まった時刻にスクレイピング→データ変換→DB更新→モデル再学習を自動実行するジョブを構築する。

## 手順
1. `backend/app/tasks/` にバッチ処理用モジュールを作成し、スクレイピング（計画12）とDB更新処理を呼び出す関数を実装。
2. スケジューラとしてAPScheduler or Celery Beatを導入し、`docker-compose` にスケジューラコンテナを追加。
3. ジョブ定義（cron表現、タイムゾーン）を設定ファイル化し、環境変数で制御できるようにする。
4. データ更新後にモデル再学習ジョブ（計画15）をキューへ投入する処理を追加。
5. ジョブの成功/失敗を通知（計画10の通知API）に連携し、管理者へアラートを飛ばす。
6. バッチ処理ログを構造化ログで出力し、`backend/tests/tasks/test_scheduler.py` でスケジュール設定のユニットテストを実施。
7. ローカルで擬似実行するためのコマンド（例: `make run-scheduler`, `python -m app.tasks.run_once`）を用意。

## 成果物
- スケジューラ設定ファイル、ジョブ実行モジュール。
- ジョブ実行ログと通知が連携した動作確認レポート。
- テスト（ユニット or integration）でジョブ処理の成功が確認できる。

## 依存・前提
- 計画12のスクレイピングと計画15の学習スクリプトが利用可能。
- 通知API（計画10）が稼働し、管理者通知が送信可能。

## リスクと対策
- **リスク**: バッチ失敗に気づかない。  
  **対策**: 成功/失敗通知と再実行用のCLIコマンドを整備。
- **リスク**: 同時実行によるデータ不整合。  
  **対策**: ロック（DBロックやRedisロック）を導入し、再入不可を保証。

