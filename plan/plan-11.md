# 実行計画 11: 管理APIと監査ログ実装

## ゴール
- 管理者がユーザー・データ・モデルを管理できるAPIを実装し、監査ログを記録する。

## 手順
1. `backend/app/models/audit_log.py` を作成し、操作内容・実行者・対象リソース・タイムスタンプを記録するテーブルを定義。
2. Alembicマイグレーションで監査ログと必要なインデックスを作成。
3. `backend/app/api/routers/admin.py` に `/api/admin/users`, `/api/admin/errors`, `/api/admin/model/train` を実装。管理者専用依存（`get_current_admin`）を利用。
4. 管理アクション実行時に監査ログが書き込まれるよう、サービス層またはFastAPIイベントでフックを実装。
5. モデル再学習APIは非同期ジョブを起動し、ジョブIDをレスポンスに含める。
6. エラーログ取得のため、ログ出力設定を構成し、必要に応じてログストレージ（Elasticsearchなど）との連携を検討。
7. `backend/tests/api/test_admin.py` に管理APIの権限制御と監査ログ出力テストを実装。

## 成果物
- 管理者用エンドポイントが動作し、監査ログがDBに記録される。
- モデル再学習ジョブの起動がAPI経由で可能。
- テストで権限制御と監査ログ記録が保証される。

## 依存・前提
- 計画05のJWT認証で管理者ロールが判別できる。
- バックグラウンド処理基盤（Celery等）が構築済み（計画09/10で整備）。

## リスクと対策
- **リスク**: 権限誤設定による情報漏洩。  
  **対策**: RBACテストと最小権限設計を徹底。
- **リスク**: 監査ログ肥大化。  
  **対策**: ログローテーションとアーカイブ方針を設定。

