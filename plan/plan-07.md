# 実行計画 07: レース参照API実装

## ゴール
- レースや参照データ（馬・騎手など）を提供するREST APIを実装し、一覧・詳細取得を可能にする。

## 手順
1. `backend/app/api/routers/races.py` を作成し、`GET /api/races`（ページネーション、開催日/場ごとのフィルタ）を実装。
2. `GET /api/races/{race_id}` の詳細レスポンスを実装し、関連データ（馬、騎手、天候）を結合。
3. `backend/app/api/routers/reference.py` に馬/騎手/調教師/天候の一覧APIを追加。
4. レスポンスを `schemas` で定義し、`Pydantic` モデルにバリデーション・ドキュメントを付与。
5. クエリパラメータのバリデーション（開催日フォーマット、場コード）を追加。
6. 必要に応じて`fastapi-cache`等でキャッシュ層を試験導入し、設定ファイルでTTLを管理。
7. `backend/tests/api/test_races.py` を実装し、正常系/異常系（存在しないID）のテストを実行。

## 成果物
- `/api/races` と参照系エンドポイントが動作するFastAPIルータ。
- OpenAPIドキュメントでフィルタ・レスポンス例が確認可能。
- CRUD・APIの単体テストが通過。

## 依存・前提
- 計画06でレース関連モデルとデータが整備済み。
- 認証が必要な場合は計画05のJWT認証を利用。

## リスクと対策
- **リスク**: 大量データ取得によるレスポンス遅延。  
  **対策**: ページネーションと必要列のみに絞ったクエリを実行。
- **リスク**: 参照APIのスキーマ変更が他機能に影響。  
  **対策**: `schemas` をversioningし、互換性変更時は影響範囲をテストで担保。

